(()=>{"use strict";var e=document.querySelector(".popup_edit"),t=document.querySelector(".popup_image"),n=document.querySelector(".profile__edit-button"),o=document.querySelector(".profile__add-button"),r=document.querySelector(".popup_fullscreen"),c=document.querySelector(".popup_fullscreen__image-capture"),a=document.querySelector(".popup_fullscreen__image"),u=document.querySelector(".popup__field_value_place-name"),l=document.querySelector(".popup__field_value_place-link"),i=document.querySelector(".popup-image__form"),s=document.querySelector("#gallery-item").content,d=document.querySelector(".gallery"),p=document.querySelector(".popup__form_profile"),f=document.querySelector(".popup__field_value_name"),_=document.querySelector(".popup__field_value_occupation"),m=document.querySelector(".profile__name"),v=document.querySelector(".profile__occupation"),y=document.querySelectorAll(".popup"),h=document.querySelector(".profile__edit-avatar"),S=document.querySelector(".popup_avatar"),q=document.querySelector(".profile__avatar"),g=S.querySelector(".popup__send"),b=e.querySelector(".popup__send"),k=document.querySelector(".profile__avatar"),E=t.querySelector(".popup__send"),L=document.querySelector(".popup__form_avatar"),C=document.querySelector(".popup__field_value_avatar-link"),j={formSelector:".popup__form",inputSelector:".popup__field",submitButtonSelector:".popup__send",inactiveButtonClass:"popup__send_disabled",inputErrorClass:"popup__field_type_error",errorClass:"popup__input-error_active"},x={baseUrl:"https://nomoreparties.co/v1/plus-cohort-11",headers:{authorization:"f3e97b96-69af-4630-b9bf-ac09d476caea","Content-Type":"application/json"}},P=function(){fetch("".concat(x.baseUrl,"/cards"),{method:"GET",headers:x.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.forEach((function(e){var t;t=function(e,t,n,o,u){var l=s.querySelector(".gallery__element").cloneNode(!0),i=l.querySelector(".gallery__image");i.src=e,l.querySelector(".gallery__title").textContent=t,i.alt=t;var d=l.querySelector(".gallery__like"),p=l.querySelector(".gallery__like-counter");u.forEach((function(e){"48ba092649dc44ea870652bd"===e._id&&d.classList.add("gallery__like_active")})),p.textContent=u.length,d.addEventListener("click",(function(){d.classList.toggle("gallery__like_active"),function(e,t,n){e.classList.contains("gallery__like_active")?function(e,t){fetch("".concat(x.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:x.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){t.textContent=e.likes.length,console.log(e.likes)}))}(t,n):function(e,t){fetch("".concat(x.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:x.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){t.textContent=e.likes.length,console.log(e.likes)}))}(t,n)}(d,n,p)}));var f=l.querySelector(".gallery__delete");return"48ba092649dc44ea870652bd"===o?f.addEventListener("click",(function(){l.remove(),function(e){fetch("".concat(x.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:x.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}(n)})):f.remove(),function(e){var t=e.querySelector(".gallery__image");t.addEventListener("click",(function(){T(r);var n=e.querySelector(".gallery__title").textContent;a.src=t.src,a.alt=t.alt,c.textContent=n}))}(l),l}(e.link,e.name,e._id,e.owner._id,e.likes),d.prepend(t)}))})).catch((function(e){console.log(e)}))};function U(e){"Escape"===e.key&&A(document.querySelector(".popup_opened"))}function T(e){e.classList.add("popup_opened"),document.addEventListener("keydown",U)}function A(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",U)}var B=function(e,t){t.textContent=e?"Сохранение...":"Сохранение"},D=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):(t.classList.add(n.inactiveButtonClass),t.disabled=!0)};i.addEventListener("submit",(function(e){var n,o,r,c;e.preventDefault(),B(!0,E),o=u.value,r=l.value,c=E,fetch("".concat(x.baseUrl,"/cards"),{method:"POST",headers:x.headers,body:JSON.stringify({name:o,link:r})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)})).finally((function(){B(!1,c)})),e.target.reset(),A(t),(n=t.querySelector(".popup__send")).classList.add(j.inactiveButtonClass),n.disabled=!0,P()})),n.addEventListener("click",(function(){T(e),f.value=m.textContent,_.value=v.textContent})),o.addEventListener("click",(function(){T(t)})),h.addEventListener("click",(function(){T(S)})),y.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup")&&A(e),t.target.classList.contains("popup__close-icon")&&A(e)}))})),P(),fetch("".concat(x.baseUrl,"/users/me"),{method:"GET",headers:x.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){m.textContent=e.name,v.textContent=e.about,k.src=e.avatar})).catch((function(e){console.log(e)})),p.addEventListener("submit",(function(t){var n,o,r;t.preventDefault(),B(!0,b),m.textContent=f.value,v.textContent=_.value,n=f.value,o=_.value,r=b,fetch("".concat(x.baseUrl,"/users/me"),{method:"PATCH",headers:x.headers,body:JSON.stringify({name:n,about:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)})).finally((function(){B(!1,r)})),A(e)})),L.addEventListener("submit",(function(e){e.preventDefault();var t,n,o=C.value;q.src=o,B(!0,g),t=o,n=g,fetch("".concat(x.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:x.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)})).finally((function(){B(!1,n)})),A(S),C.value=""})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);D(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));r.textContent=n,r.classList.add(o.errorClass),t.classList.add(o.inputErrorClass)}(e,t,t.validationMessage,n)}(e,r,t),D(n,o,t)}))}))}(t,e)}))}(j)})();